<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Logowanie</title>
<link rel="stylesheet" type="text/css" href="view.css" media="all">
<script type="text/javascript" src="view.js"></script>
<script type="text/javascript" src="../js/connection_functions.js"></script>

</head>
<body id="main_body" >
<a href="../rejestracja/index.html">Rejestracja</a> | <a href="../logowanie/index.html">Logowanie</a> | <a href="../gra/index.html">Gra</a>
<script>
		
		establish_connection();
		
		ws.onmessage = function (event) {
			var obj = JSON.parse(event.data);
			console.log(obj)
			
			if(obj["type"] == "connected")
			{
				connected(obj['connectionId']);
			}
			if(obj["type"] == "ping")
			{
				sendPong();
			}
			
			if(obj['type']=='userlogin' && obj['result']=='false')
			{
				document.getElementById("message").innerHTML = "<strong>Podany e-mail lub hasło są nieprawidłowe!</strong>";
				document.getElementById("message").style.color = "red";
			}
			if(obj['type']=='userlogin' && obj['result']=='true')
			{
				document.getElementById("message").innerHTML = "";
				
				localStorage.setItem('playerid', obj['userid']);
				localStorage.setItem('session_id', obj['sessionId']);
				localStorage.setItem('login', obj['login']);
				
				alert("Zalogowany! Przekierowanie");
			}
		}
		
function login() {

var ok = true;
var email = document.getElementById("email").value;
var pass = document.getElementById("password").value;

document.getElementById("memail").innerHTML = '';
document.getElementById("mpass").innerHTML = '';

if(email=='')
{
	document.getElementById("memail").innerHTML = "Podaj e-mail";
	ok=false;
}
if(pass=='')
{
	document.getElementById("mpass").innerHTML = "Podaj hasło";
	ok=false;
}

if(ok) {
	ws.send(JSON.stringify({
	'connectionId':connectionId,
	'type':'userlogin',
	'email':email,
	'password':pass,
	}));
}


}


</script>
	
	<img id="top" src="top.png" alt="">
	<div id="form_container">
	
		<h1><a>Logowanie</a></h1>
		<form id="form_105586" class="appnitro"  method="post" action="">
					<div class="form_description">
			<h2>Logowanie</h2>
			<p>Zaloguj się żeby brać udział w grach</p>
			<p id="message"></p>
		</div>						
			<ul >
			
					<li id="li_1" >
		<label class="description" for="element_1">E-mail </label> <label id="memail"style="color:red"></label>
		<div>
			<input id="email" name="email" class="element text medium" type="text" maxlength="255" value=""/> 
		</div> 
		</li>		<li id="li_3" >
		<label class="description" for="element_3">Hasło </label> <label id="mpass"style="color:red"></label>
		<div>
			<input id="password" name="password" class="element text medium" type="text" maxlength="255" value=""/> 
		</div> 
		</li>
			
					<li class="buttons">
			    <input type="hidden" name="form_id" value="105586" />
		</li>
			</ul>
		</form>	
		<button id="saveForm" onclick="login();" style="margin-left:30px;">Zaloguj</button>
		<div id="footer">
			Generated by <a href="http://www.phpform.org">pForm</a>
		</div>
	</div>
	<img id="bottom" src="bottom.png" alt="">
	</body>
</html>